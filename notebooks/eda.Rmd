---
title: "Heart Disease Dataset â€“ Exploratory Analysis"
author: "Atilul Islam Sajib, Zafrin Sultana, Sakib Hasan, & Mohammad Mahmudul Hasan"
output:
  html_document:
    theme: cosmo
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
library(ggplot2)
library(GGally)
library(dplyr)
library(corrplot)

set.seed(123)

check_missing <- function(df) colSums(is.na(df))
class_balance <- function(df) table(df$HeartDisease)
```

# Introduction

This report provides an exploratory data analysis (EDA) of the processed **Heart Disease Training dataset**.

---

# Load Dataset

```{r}
train <- read.csv("../data/processed/train_scaled.csv", stringsAsFactors = TRUE)

print_basic_info <- function(df, target_col) {
  cat("\nData overview\n")
  print(dim(df))
  str(df)
  
  cat("\n\nSummary:\n")
  print(summary(df))
  
  cat("\nMissing values:\n")
  print(check_missing(df))
  
  cat("\nTarget class balance:\n")
  print(class_balance(df))
}

print_basic_info(train, "HeartDisease")

numeric_cols <- c("Age", "RestingBP", "Cholesterol",
                  "FastingBS", "MaxHR", "Oldpeak")

cat_cols <- c("Sex", "ChestPainType", "RestingECG",
              "ExerciseAngina", "ST_Slope")
```

# 1. Distribution of Target class

```{r pie_chart}
pie_data <- train %>% 
  count(HeartDisease) %>% 
  mutate(prop = n / sum(n),
         lbl = paste0(HeartDisease, " (", scales::percent(prop), ")"))

ggplot(pie_data, aes(x = "", y = prop, fill = HeartDisease)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  theme_void() +
  labs(title = "HeartDisease Class Distribution (Pie Chart)") +
  geom_text(aes(label = lbl), position = position_stack(vjust = 0.5))
```

# 2. Distribution of Numeric Features

```{r}
for (col in numeric_cols) {
  print(
    ggplot(train, aes_string(x = col)) +
      geom_histogram(bins = 30, fill = "skyblue", color = "black") +
      theme_minimal() +
      labs(title = paste("Distribution of", col))
  )
}
```

# 3. Distribution of Categorical Features

```{r}
for (col in cat_cols) {
  print(
    ggplot(train, aes_string(x = col)) +
      geom_bar(fill = "orange", color = "black") +
      theme_minimal() +
      labs(title = paste("Distribution of", col))
  )
}
```

# 4. Numeric Features vs Heart Disease (Boxplots)

```{r}
for (col in numeric_cols) {
  print(
    ggplot(train, aes_string(x = "HeartDisease", y = col, fill = "HeartDisease")) +
      geom_boxplot() +
      theme_minimal() +
      labs(title = paste(col, "by HeartDisease"))
  )
}
```

# 5. Categorical Features vs Heart Disease (Proportion Plots)

```{r}
for (col in cat_cols) {
  print(
    ggplot(train, aes_string(x = col, fill = "HeartDisease")) +
      geom_bar(position = "fill") +
      theme_minimal() +
      labs(title = paste(col, "vs HeartDisease (Proportion)"),
           y = "Proportion")
  )
}
```

# 6. Correlation Matrix

```{r}
numeric_data <- train[, numeric_cols]
cor_mat <- cor(numeric_data)

corrplot(cor_mat,
         method = "color",
         type = "upper",
         addCoef.col = "black",
         number.cex = 0.7,
         tl.cex = 0.8,
         tl.col = "black")
```

# 7. Scatter Plots (Age vs Key Numeric Features)

```{r}
key_pairs <- c("RestingBP", "Cholesterol", "MaxHR", "Oldpeak")

for (col in key_pairs) {
  print(
    ggplot(train, aes_string(x = "Age", y = col, color = "HeartDisease")) +
      geom_point(alpha = 0.6, size = 2) +
      theme_minimal() +
      labs(
        title = paste("Scatter Plot:", "Age vs", col),
        x = "Age",
        y = col
      )
  )
}
```

# 8. Scatter Plot With Smooth Trend Line

```{r}
ggplot(train, aes(Age, MaxHR, color = HeartDisease)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "loess", se = TRUE) +
  theme_minimal() +
  labs(title = "Age vs MaxHR with Trend Line")
```

# 9. Faceted Scatter Plot (MaxHR vs Oldpeak by Sex)

```{r}
ggplot(train, aes(MaxHR, Oldpeak, color = HeartDisease)) +
  geom_point(alpha = 0.6) +
  facet_wrap(~ Sex) +
  theme_minimal() +
  labs(title = "MaxHR vs Oldpeak (Faceted by Sex)")
```

# 10. Pairplot for Numeric Features

```{r}
ggpairs(
  train[, c(numeric_cols, "HeartDisease")],
  aes(color = HeartDisease, alpha = 0.5)
)
```
